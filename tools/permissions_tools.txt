# Permissions and Ownership for Tools Directory Structure
# Generated by Grok for vinanetwork on 2025-06-18 14:40 +07
# Purpose: Define permissions and ownership for Tools functionality and Git
# Web Server: Apache, running as www-data:www-data
# PHP: php-fpm, running as www-data:www-data
# Git: Managed by user n9u93n, separate from www-data
# Notes:
# - Directories: 755 (rwx for owner, rx for group/others) for executable dirs
# - PHP/CSS/JS files: 644 (rw for owner, r for group/others) for read-only
# - Log/Cache files: 664 (rw for owner/group, r for others) for www-data write access
# - .git/: Owned by n9u93n:n9u93n for Git operations
# - Owner/Group: www-data:www-data for Apache/PHP, n9u93n:n9u93n for .git/
# - Commands are provided for each directory/file to set permissions and ownership
# - Run commands as root (sudo) and verify after applying
# - Parent directories (/var/www, /var/www/vinanetwork, /var/www/vinanetwork/public_html)
#   should be 755 and owned by www-data:www-data
# - General apply commands (for bulk changes):
#   sudo chown -R www-data:www-data /var/www/vinanetwork/public_html
#   sudo find /var/www/vinanetwork/public_html -not -path "/var/www/vinanetwork/public_html/.git/*" -type d -exec chmod 755 {} \;
#   sudo find /var/www/vinanetwork/public_html -not -path "/var/www/vinanetwork/public_html/.git/*" -type f -exec chmod 644 {} \;
#   sudo chmod 764 /var/www/vinanetwork/public_html/tools/logs
#   sudo find /var/www/vinanetwork/public_html/tools/logs -type f -exec chmod 664 {} \;
#   sudo chmod 764 /var/www/vinanetwork/public_html/tools/nft-holders/cache
#   sudo find /var/www/vinanetwork/public_html/tools/nft-holders/cache -type f -exec chmod 664 {} \;
#   sudo chown -R n9u93n:n9u93n /var/www/vinanetwork/public_html/.git
#   sudo chmod -R u+rwX,go+rX /var/www/vinanetwork/public_html/.git

[Directory Structure and Permissions]

/var/www/vinanetwork/public_html/
- Permissions: drwxr-xr-x (755)
- Owner/Group: www-data:www-data
- Description: Root web directory, contains Tools and .git/.
- Commands:
  sudo chown www-data:www-data /var/www/vinanetwork/public_html
  sudo chmod 755 /var/www/vinanetwork/public_html

├── .git/
- Permissions: drwxr-xr-x (755)
- Owner/Group: n9u93n:n9u93n
- Description: Git repository directory, managed by n9u93n for git pull/commit/push.
- Commands:
  sudo chown -R n9u93n:n9u93n /var/www/vinanetwork/public_html/.git
  sudo chmod -R u+rwX,go+rX /var/www/vinanetwork/public_html/.git

├── tools/
- Permissions: drwxr-xr-x (755)
- Owner/Group: www-data:www-data
- Description: Root directory for Tools page, contains PHP, CSS, JS, and subdirs.
- Commands:
  sudo chown www-data:www-data /var/www/vinanetwork/public_html/tools
  sudo chmod 755 /var/www/vinanetwork/public_html/tools

│   ├── index.php
- Permissions: -rw-r--r-- (644)
- Owner/Group: www-data:www-data
- Description: Main entry point for Tools page, read/executed by Apache.
- Commands:
  sudo chown www-data:www-data /var/www/vinanetwork/public_html/tools/index.php
  sudo chmod 644 /var/www/vinanetwork/public_html/tools/index.php

│   ├── tools-load.php
- Permissions: -rw-r--r-- (644)
- Owner/Group: www-data:www-data
- Description: PHP script for loading Tools functionality, read/executed by Apache.
- Commands:
  sudo chown www-data:www-data /var/www/vinanetwork/public_html/tools/tools-load.php
  sudo chmod 644 /var/www/vinanetwork/public_html/tools/tools-load.php

│   ├── tools-api.php
- Permissions: -rw-r--r-- (644)
- Owner/Group: www-data:www-data
- Description: API handler for Tools, read/executed by Apache.
- Commands:
  sudo chown www-data:www-data /var/www/vinanetwork/public_html/tools/tools-api.php
  sudo chmod 644 /var/www/vinanetwork/public_html/tools/tools-api.php

│   ├── bootstrap.php
- Permissions: -rw-r--r-- (644)
- Owner/Group: www-data:www-data
- Description: Bootstrap script for Tools, read/executed by Apache.
- Commands:
  sudo chown www-data:www-data /var/www/vinanetwork/public_html/tools/bootstrap.php
  sudo chmod 644 /var/www/vinanetwork/public_html/tools/bootstrap.php

│   ├── tools.css
- Permissions: -rw-r--r-- (644)
- Owner/Group: www-data:www-data
- Description: CSS stylesheet for Tools, served by Apache.
- Commands:
  sudo chown www-data:www-data /var/www/vinanetwork/public_html/tools/tools.css
  sudo chmod 644 /var/www/vinanetwork/public_html/tools/tools.css

│   ├── tools.js
- Permissions: -rw-r--r-- (644)
- Owner/Group: www-data:www-data
- Description: JavaScript for Tools, served by Apache.
- Commands:
  sudo chown www-data:www-data /var/www/vinanetwork/public_html/tools/tools.js
  sudo chmod 644 /var/www/vinanetwork/public_html/tools/tools.js

│   ├── nft-holders/
- Permissions: drwxr-xr-x (755)
- Owner/Group: www-data:www-data
- Description: Directory for NFT Holders functionality, contains PHP scripts and cache.
- Commands:
  sudo chown www-data:www-data /var/www/vinanetwork/public_html/tools/nft-holders
  sudo chmod 755 /var/www/vinanetwork/public_html/tools/nft-holders

│   │   ├── nft-holders.php
- Permissions: -rw-r--r-- (644)
- Owner/Group: www-data:www-data
- Description: Main script for NFT Holders, processes collection addresses, logs, caches.
- Commands:
  sudo chown www-data:www-data /var/www/vinanetwork/public_html/tools/nft-holders/nft-holders.php
  sudo chmod 644 /var/www/vinanetwork/public_html/tools/nft-holders/nft-holders.php

│   │   ├── nft-holders-export.php
- Permissions: -rw-r--r-- (644)
- Owner/Group: www-data:www-data
- Description: Script for exporting NFT Holders data, read/executed by Apache.
- Commands:
  sudo chown www-data:www-data /var/www/vinanetwork/public_html/tools/nft-holders/nft-holders-export.php
  sudo chmod 644 /var/www/vinanetwork/public_html/tools/nft-holders/nft-holders-export.php

│   │   ├── cache/
- Permissions: drwxrw-r-- (764)
- Owner/Group: www-data:www-data
- Description: Directory for NFT Holders cache files, writable by www-data for PHP caching.
- Commands:
  sudo chown www-data:www-data /var/www/vinanetwork/public_html/tools/nft-holders/cache
  sudo chmod 764 /var/www/vinanetwork/public_html/tools/nft-holders/cache

│   │   │   └── nft_holders_cache.json
- Permissions: -rw-rw-r-- (664)
- Owner/Group: www-data:www-data
- Description: Cache file for NFT Holders data, written by PHP.
- Commands:
  sudo chown www-data:www-data /var/www/vinanetwork/public_html/tools/nft-holders/cache/nft_holders_cache.json
  sudo chmod 664 /var/www/vinanetwork/public_html/tools/nft-holders/cache/nft_holders_cache.json

│   ├── logs/
- Permissions: drwxrw-r-- (764)
- Owner/Group: www-data:www-data
- Description: Directory for log files, writable by www-data for PHP logging.
- Commands:
  sudo chown www-data:www-data /var/www/vinanetwork/public_html/tools/logs
  sudo chmod 764 /var/www/vinanetwork/public_html/tools/logs

│   │   ├── api_log.txt
- Permissions: -rw-rw-r-- (664)
- Owner/Group: www-data:www-data
- Description: Logs API requests/responses, written by PHP.
- Commands:
  sudo chown www-data:www-data /var/www/vinanetwork/public_html/tools/logs/api_log.txt
  sudo chmod 664 /var/www/vinanetwork/public_html/tools/logs/api_log.txt

│   │   ├── client_log.txt
- Permissions: -rw-rw-r-- (664)
- Owner/Group: www-data:www-data
- Description: Logs client-side interactions, written by PHP.
- Commands:
  sudo chown www-data:www-data /var/www/vinanetwork/public_html/tools/logs/client_log.txt
  sudo chmod 664 /var/www/vinanetwork/public_html/tools/logs/client_log.txt

│   │   ├── load_tool_log.txt
- Permissions: -rw-rw-r-- (664)
- Owner/Group: www-data:www-data
- Description: Logs tool loading events, written by PHP.
- Commands:
  sudo chown www-data:www-data /var/www/vinanetwork/public_html/tools/logs/load_tool_log.txt
  sudo chmod 664 /var/www/vinanetwork/public_html/tools/logs/load_tool_log.txt

│   │   ├── nft_holders_log.txt
- Permissions: -rw-rw-r-- (664)
- Owner/Group: www-data:www-data
- Description: Logs NFT Holders processing (mintAddress, cache, API), written by PHP.
- Commands:
  sudo chown www-data:www-data /var/www/vinanetwork/public_html/tools/logs/nft_holders_log.txt
  sudo chmod 664 /var/www/vinanetwork/public_html/tools/logs/nft_holders_log.txt

│   │   ├── php_errors.txt
- Permissions: -rw-rw-r-- (664)
- Owner/Group: www-data:www-data
- Description: Logs PHP errors, written by PHP.
- Commands:
  sudo chown www-data:www-data /var/www/vinanetwork/public_html/tools/logs/php_errors.txt
  sudo chmod 664 /var/www/vinanetwork/public_html/tools/logs/php_errors.txt

│   │   └── tools_log.txt
- Permissions: -rw-rw-r-- (664)
- Owner/Group: www-data:www-data
- Description: General logs for Tools functionality, written by PHP.
- Commands:
  sudo chown www-data:www-data /var/www/vinanetwork/public_html/tools/logs/tools_log.txt
  sudo chmod 664 /var/www/vinanetwork/public_html/tools/logs/tools_log.txt

[Git Setup Instructions]
# Ensure n9u93n can manage Git while www-data runs Apache/PHP
# 1. Setup SSH key for n9u93n (no passphrase)
mv ~/.ssh/id_ed25519 ~/.ssh/id_ed25519_old
mv ~/.ssh/id_ed25519.pub ~/.ssh/id_ed25519_old.pub
ssh-keygen -t ed25519 -C "n9u93n@vinanetwork" -f ~/.ssh/id_ed25519 -N ""
cat ~/.ssh/id_ed25519.pub  # Copy output to GitHub (Settings > SSH and GPG keys)
ssh -T git@github.com  # Verify: "Hi VinaNetwork! You've successfully authenticated..."
# 2. Configure Git to use SSH
cd /var/www/vinanetwork/public_html
git remote set-url origin git@github.com:VinaNetwork/Vina.Network.git
# 3. Test Git
git pull origin main
# 4. Optional: Automate git pull with script
nano ~/git-pull.sh
# Add:
# #!/bin/bash
# cd /var/www/vinanetwork/public_html
# git pull origin main
# echo "Git pull completed at $(date)"
chmod +x ~/git-pull.sh
~/git-pull.sh  # Test
# 5. Optional: Schedule with cron
crontab -e
# Add: 0 * * * * /home/n9u93n/git-pull.sh >> /home/n9u93n/git-pull.log 2>&1

[Commands to Verify Permissions]
# Run these to check current permissions:
ls -ld /var/www/vinanetwork/public_html/ /var/www/vinanetwork/public_html/.git/
ls -l /var/www/vinanetwork/public_html/.git/
ls -ld /var/www/vinanetwork/public_html/tools/
ls -l /var/www/vinanetwork/public_html/tools/
ls -ld /var/www/vinanetwork/public_html/tools/{nft-holders,logs}/
ls -l /var/www/vinanetwork/public_html/tools/nft-holders/
ls -l /var/www/vinanetwork/public_html/tools/nft-holders/cache/
ls -l /var/www/vinanetwork/public_html/tools/logs/

[Notes]
- Ensure Apache/PHP run as www-data (check with `ps aux | grep apache2` and `ps aux | grep php`).
- .git/ is owned by n9u93n:n9u93n to allow git pull/commit/push, separate from www-data.
- Use `find ... -not -path ...` to avoid overwriting .git/ when setting www-data permissions.
- If permissions issues persist, check parent dirs (/var/www, /var/www/vinanetwork) for 755 and www-data:www-data.
- Log and cache files need 664 to allow PHP (www-data) write access while readable by others.
- No executable permissions (x) needed for PHP/CSS/JS/log/cache files, only for directories.
- Apply changes carefully to avoid downtime; test after applying (e.g., https://vina.network/tools/check-nft-holders).
- If /nft-holders/cache/ or nft_holders_cache.json does not exist, create them:
  sudo mkdir -p /var/www/vinanetwork/public_html/tools/nft-holders/cache
  sudo touch /var/www/vinanetwork/public_html/tools/nft-holders/cache/nft_holders_cache.json
  sudo chown www-data:www-data /var/www/vinanetwork/public_html/tools/nft-holders/cache
  sudo chmod 764 /var/www/vinanetwork/public_html/tools/nft-holders/cache
  sudo chown www-data:www-data /var/www/vinanetwork/public_html/tools/nft-holders/cache/nft_holders_cache.json
  sudo chmod 664 /var/www/vinanetwork/public_html/tools/nft-holders/cache/nft_holders_cache.json
