Tài Liệu Thiết Kế Trang Công Cụ Tools - Vina Network
Phiên bản: 1.0  
Ngày tạo: 23/06/2025  
Tác giả: Vina Network Team
Mục đích: Tài liệu này mô tả thiết kế và yêu cầu kỹ thuật cho trang công cụ Tools trên website Vina Network, cung cấp 3 chức năng chính: Check NFT Info, Check NFT Holders, và Check Wallet Analysis, nhằm hỗ trợ người dùng phân tích dữ liệu blockchain Solana.

---

1. Tổng Quan

1.1. Mục Tiêu
Trang công cụ Tools (https://vina.network/tools/) là một phần của website Vina Network, cung cấp các công cụ phân tích dữ liệu blockchain Solana cho người dùng như NFT creators, collectors, investors, và developers. Ba chức năng chính:
- Check NFT Info: Tra cứu thông tin chi tiết của một NFT Solana dựa trên Mint Address.
- Check NFT Holders: Kiểm tra số lượng ví sở hữu NFT và tổng số NFT trong một bộ sưu tập Solana dựa trên Collection Address.
- Check Wallet Analysis: Phân tích số dư và tài sản (SOL, SPL tokens, NFTs) của một ví Solana dựa trên Wallet Address.

1.2. Đối Tượng Người Dùng
- NFT Creators: Theo dõi thông tin và phân phối bộ sưu tập NFT.
- NFT Collectors/Investors: Tra cứu NFT hoặc ví để đánh giá đầu tư.
- Người dùng Solana: Kiểm tra số dư ví hoặc thông tin NFT cá nhân.
- Developers: Sử dụng dữ liệu từ công cụ để tích hợp hoặc phân tích.

1.3. Yêu Cầu Chung
- Giao diện: Responsive, thân thiện, tối ưu cho desktop và mobile.
- Hiệu suất: Cache dữ liệu API (3 giờ), thời gian tải < 2 giây.
- Bảo mật: CSRF token, rate limiting (5 requests/phút/IP), validate input (base58).
- Khả năng mở rộng: Dễ thêm công cụ mới.
- SEO: Tối ưu meta tags cho từng công cụ.

---

2. Cấu Trúc Trang Tools

2.1. URL và Cách Truy Cập
- URL chính: `https://vina.network/tools/`
- Query parameter: `?tool=<tool_name>` để chọn công cụ:
  - `?tool=nft-info` → Check NFT Info
  - `?tool=nft-holders` → Check NFT Holders
  - `?tool=wallet-analysis` → Check Wallet Analysis
- Mặc định: Nếu không có `tool`, hiển thị `nft-info`.

2.2. Cấu Trúc Thư Mục
/var/www/vinanetwork/public_html
├── css/
│   ├── all.css
│   ├── poppins.css
│   └── vina.css
│
├── js/
│   └── vina.js
│
├── fonts/
│   ├── ...
│
├── webfonts/
│   ├── ...
│
├── img/
│   ├── ...
│
├── include/
│   ├── header.php
│   ├── community.php
│   ├── footer.php
│   └── navbar.php
│
├── config/
│   └── config.php
│
├── tools/
│   ├── index.php (Trang chủ Tools)
│   ├── tools-load.php
│   ├── tools-api.php
│   ├── bootstrap.php
│   ├── tools.css
│   ├── tools.js
│   ├── nft-holders/
│   │   ├── nft-holders.php
│   │   ├── nft-holders-export.php
│   │   └── cache/
│   │       └── nft_holders_cache.json
│   ├── nft-info/
│   │   ├── nft-info.php
│   │   └── cache/
│   │       └── nft_info_cache.json
│   ├── wallet-analysis/
│   │   ├── wallet-analysis.php
│   │   └── cache/
│   │       └── wallet_analysis_cache.json
│   ├── image/
│   │   ├── ...
│   ├── logs/
│   └──   ├── ...
└──

- index.php (tools): Trang chính, quản lý tab navigation và load công cụ.
- tools-load.php: Load nội dung công cụ qua AJAX.
- tools-api.php: Wrapper gọi Helius RPC API (Solana).
- bootstrap.php: Khởi tạo hằng số, logging, CSRF.
- tools.css, tools.js: CSS và JS cho trang Tools.
- nft-holders.php, nft-info.php, wallet-analysis.php: Logic và giao diện từng công cụ.
- nft-holders-export.php: Xuất dữ liệu holders (CSV/JSON).
- cache/: Lưu cache API (3 giờ).
- logs/: Lưu log (php_errors.txt, tools_api_log.txt, v.v.).

2.3. Cấu Trúc Giao Diện
- Header: Meta tags, CSS, title (từ `include/header.php`).
- Navbar: Menu điều hướng (từ `include/navbar.php`).
- Content (`section.tools`):
  - Tools Navigation (`.tools-nav`): Tab chọn công cụ (NFT Info, NFT Holders, Wallet Analysis).
  - Note: Thông báo “Only supports Solana blockchain”.
  - Tools Content (`.tools-content`):
    - Form (`.tools-form`): Input (Mint Address, Collection Address, Wallet Address), button submit.
    - Result (`.tools-result`): Kết quả tra cứu (card, table).
    - Error (`.result-error`): Thông báo lỗi (rate limit, invalid input).
    - About (`.tools-about`): Mô tả công cụ.
- Footer: Chân trang (từ `include/footer.php`).

2.4. Responsive Design
- Desktop: Tabs ngang, form/result căn giữa, table full-width.
- Mobile:
  - Tabs scroll ngang (`.tools-nav::-webkit-scrollbar`).
  - Form input/button full-width.
  - Tables scroll ngang (`.token-table`, `.nft-table`).
- CSS: Sử dụng `css/vina.css` (layout chung) và `tools/tools.css` (style riêng).

---

3. Chi Tiết Chức Năng
3.1. Check NFT Info
- Mục đích: Tra cứu thông tin chi tiết của một NFT Solana.
- URL: `https://vina.network/tools/?tool=nft-info`
- File: `tools/nft-info/nft-info.php`
- Input: Mint Address (base58, 32-44 ký tự, ví dụ: `4zM...xYz`).
- Output:
  - Mint Address (rút gọn + copy icon).
  - Name.
  - Image (nếu có).
  - Attributes (JSON).
  - Owner (rút gọn + copy icon).
  - Collection (rút gọn + copy icon).
  - Compressed (Yes/No).
  - Burned (Yes/No).
  - Listed (Yes/No).
  - Cache timestamp (nếu dùng cache).
- API: `getAsset` (Helius RPC).
- Cache: `nft_info_cache.json` (3 giờ).
- Giao diện:
  - Form (`.tools-form`):
    - Input: `mintAddress`, placeholder: “Enter NFT Mint Address”.
    - Button: “Check Info”.
    - Loader: Spinner (`.loader`).
  - Result (`.tools-result.nft-info-result`):
    - Card (`.result-card`): Image (`.nft-image`), table (`.nft-info-table`).
    - Cache timestamp (`.cache-timestamp`).
  - Error (`.result-error`): Invalid address, API error, rate limit.
  - About (`.tools-about`): Mô tả công cụ.
- Logic (từ `nft-info.php`):
  1. Kiểm tra CSRF token.
  2. Validate Mint Address (regex `/^[1-9A-HJ-NP-Za-km-z]{32,44}$/`).
  3. Kiểm tra cache (3 giờ).
  4. Nếu không có cache, gọi API `getAsset`.
  5. Format dữ liệu (Mint Address, Name, Image, v.v.).
  6. Lưu cache (file lock với `flock`).
  7. Hiển thị form trước kết quả.

3.2. Check NFT Holders
- Mục đích: Kiểm tra số lượng ví sở hữu NFT và tổng số NFT trong bộ sưu tập.
- URL: `https://vina.network/tools/?tool=nft-holders`
- File: `tools/nft-holders/nft-holders.php`, `nft-holders-export.php`
- Input: Collection Address (base58, 32-44 ký tự, ví dụ: `8xQ...pQz`).
- Output:
  - Total Wallets.
  - Total NFTs.
  - Cache timestamp (nếu dùng cache).
  - Export button (CSV/JSON, `.export-section`).
- API: `getAssetsByGroup` (Helius RPC, phân trang, max 500 trang, limit 1000).
- Cache: `nft_holders_cache.json` (3 giờ).
- Giao diện:
  - Form (`.tools-form`):
    - Input: `mintAddress`, placeholder: “Enter NFT Collection Address”.
    - Button: “Check Holders”.
    - Loader: Spinner (`.loader`).
  - Result (`.tools-result.nft-holders-result`):
    - Card (`.result-card`): Total Wallets, Total NFTs (`.result-item`).
    - Export form: Select format (`.export-format`), button “Export All Wallets” (`.export-btn`).
    - Progress bar (`.progress-container`).
    - Cache timestamp (`.cache-timestamp`).
  - Error (`.result-error`): Invalid address, API error, rate limit.
  - About (`.tools-about`): Mô tả công cụ.
- Logic (từ `nft-holders.php`, `nft-holders-export.php`):
  1. Kiểm tra CSRF token.
  2. Validate Collection Address (regex base58).
  3. Kiểm tra cache (3 giờ).
  4. Nếu không có cache:
     - Gọi API `getAssetsByGroup` (phân trang, timeout 60s).
     - Tính unique wallets và total NFTs.
     - Lưu cache (file lock).
  5. Hiển thị form trước kết quả.
  6. Export: Gửi POST đến `nft-holders-export.php`, trả về file CSV/JSON.

3.3. Check Wallet Analysis
- Mục đích: Phân tích số dư và tài sản của ví Solana.
- URL: `https://vina.network/tools/?tool=wallet-analysis`
- File: `tools/wallet-analysis/wallet-analysis.php`
- Input: Wallet Address (base58, 32-44 ký tự, ví dụ: `7C4...k9z`).
- Output:
  - Wallet Address (rút gọn + copy icon).
  - SOL Balance (SOL, USD).
  - Tokens (SPL): Name, Token Address (rút gọn + copy icon), Balance, Value (USD).
  - NFTs: Name, Mint Address (rút gọn + copy icon), Collection (rút gọn + copy icon).
  - Cache timestamp (nếu dùng cache).
- API: `getAssetsByOwner` (Helius RPC).
- Cache: `wallet_analysis_cache.json` (3 giờ).
- Giao diện:
  - Form (`.tools-form`):
    - Input: `walletAddress`, placeholder: “Enter Solana Wallet Address”.
    - Button: “Check Wallet”.
    - Loader: Spinner (`.loader`).
  - Result (`.tools-result.wallet-analysis-result`):
    - Summary card (`.result-card`): Wallet Address, SOL Balance.
    - Token table (`.token-table`): Name, Token Address, Balance, Value.
    - NFT table (`.nft-table`): Name, Mint Address, Collection.
    - Cache timestamp (`.cache-timestamp`).
  - Error (`.result-error`): Invalid address, API error, rate limit.
  - About (`.tools-about`): Mô tả công cụ.
- Logic (từ `wallet-analysis.php`):
  1. Kiểm tra CSRF token.
  2. Validate Wallet Address (regex base58).
  3. Kiểm tra cache (3 giờ).
  4. Nếu không có cache, gọi API `getAssetsByOwner`.
  5. Format dữ liệu (SOL, tokens, NFTs).
  6. Lưu cache (file lock).
  7. Hiển thị form trước kết quả.

---

4. Yêu Cầu Kỹ Thuật
4.1. Backend
- Ngôn ngữ: PHP 7.4+.
- Dependencies:
  - `session_start()`: Quản lý session (rate limit, CSRF).
  - `file_get_contents()`, `file_put_contents()`, `flock()`: Cache.
  - `curl`: Gọi API Helius (từ `tools-api.php`).
- Rate Limiting:
  - 5 requests/phút/IP.
  - Key: `rate_limit_nft_info:$ip`, `rate_limit_nft_holders:$ip`, `rate_limit_wallet_analysis:$ip`.
  - Lưu trong `$_SESSION`, reset sau 60s.
- Cache:
  - Format: JSON (`nft_info_cache.json`, `nft_holders_cache.json`, `wallet_analysis_cache.json`).
  - TTL: 3 giờ.
  - Quyền: `chmod 0644`, `chown www-data:www-data`.
- Bảo mật:
  - CSRF token: `generate_csrf_token()`, `validate_csrf_token()` (từ `bootstrap.php`).
  - Validate input: Regex base58 (`/^[1-9A-HJ-NP-Za-km-z]{32,44}$/`).
  - Escape output: `htmlspecialchars()`.
- Logging:
  - Files: `tools_api_log.txt`, `nft_info_log.txt`, `nft_holders_log.txt`, `wallet_analysis_log.txt`, `tools_load_log.txt`, `holders_export_log.txt`.
  - Path: `tools/logs/`.
  - Levels: INFO, DEBUG, WARNING, ERROR.
  - Quyền: `chmod 0664`, `chown www-data:www-data`.

4.2. Frontend
- HTML/CSS:
  - Classes: `.tools`, `.tools-container`, `.tools-nav`, `.tools-form`, `.tools-result`, `.result-error`, `.tools-about`.
  - CSS files: `css/vina.css`, `tools/tools.css`.
- JavaScript (từ `tools.js`):
  - Tab navigation: Click `.tools-nav-link`, load nội dung qua `tools-load.php`.
  - Form submit: POST AJAX đến `tools-load.php`.
  - Export (NFT Holders): POST đến `nft-holders-export.php`, hiển thị progress bar.
  - Copy icon: Copy address (Clipboard API hoặc fallback `document.execCommand`).
- Responsive:
  - Mobile: Tabs scroll ngang, input/button full-width, tables scroll ngang.
  - Desktop: Tabs cố định, tables full-width, form/result căn giữa.
- SEO:
  - Meta title: `{Tool Title} - Vina Network`.
  - Meta description: 100-160 ký tự.
  - OG tags: `og:title`, `og:description`, `og:image`, `og:url`.

4.3. API
- Provider: Helius RPC (`https://mainnet.helius-rpc.com/`).
- Endpoints:
  - `getAsset`: Check NFT Info.
  - `getAssetsByGroup`: Check NFT Holders.
  - `getAssetsByOwner`: Check Wallet Analysis.
- Timeout: 30s (NFT Info, Wallet Analysis), 60s (NFT Holders).
- Rate Limit: Xử lý HTTP 429 (retry 3 lần, delay 2s).

4.4. Server
- OS: Linux (Ubuntu/CentOS).
- Web Server: Apache (với `.htaccess`).
- PHP-FPM: 7.4+.
- Quyền:
  chmod -R 750 /var/www/vinanetwork/public_html/tools/
  chmod -R 770 /var/www/vinanetwork/public_html/tools/*/cache/
  chmod -R 770 /var/www/vinanetwork/public_html/tools/logs/
  chown -R www-data:www-data /var/www/vinanetwork/public_html/

---

5. Quy Trình Vận Hành
5.1. Triển Khai
1. Copy file:
   - Dán code vào `tools/index.php`, `tools-load.php`, `tools-api.php`, `bootstrap.php`, `nft-holders/*.php`, `nft-info/*.php`, `wallet-analysis/*.php`, `tools.css`, `tools.js`.
2. Backup:
   mkdir -p /var/www/vinanetwork/backup_20250623_tools
   cp -r /var/www/vinanetwork/public_html/tools/* /var/www/vinanetwork/backup_20250623_tools/

3. Set quyền:
   chmod 644 /var/www/vinanetwork/public_html/tools/*.php
   chmod 644 /var/www/vinanetwork/public_html/tools/*/*.php
   chmod 664 /var/www/vinanetwork/public_html/tools/*/cache/*.json
   chmod 664 /var/www/vinanetwork/public_html/tools/logs/*.txt
   chown -R www-data:www-data /var/www/vinanetwork/public_html/tools/

4. Xóa cache:
   rm -f /var/www/vinanetwork/public_html/tools/*/cache/*.json
   php -r "opcache_reset();"

5. Restart server:
   sudo systemctl restart php-fpm
   sudo systemctl restart apache2

5.2. Kiểm Tra
- Cú pháp:
  php -l /var/www/vinanetwork/public_html/tools/*.php
  php -l /var/www/vinanetwork/public_html/tools/*/*.php
 
- Chức năng:
  - Test tab navigation: Chuyển đổi giữa NFT Info, NFT Holders, Wallet Analysis.
  - Test form submit: Kiểm tra kết quả, đảm bảo form (`.tools-form`) trên kết quả (`.tools-result`).
  - Test rate limit: Submit >5 lần/phút, chỉ thấy `.result-error`.
  - Test export (NFT Holders): Kiểm tra file CSV/JSON.
  - Test copy icon: Copy full address (Mint, Wallet, Collection).
- Log:
  tail -n 100 /var/www/vinanetwork/public_html/tools/logs/*.txt

5.3. Bảo Trì
- Xóa cache định kỳ:
  find /var/www/vinanetwork/public_html/tools/*/cache/ -type f -mtime +7 -delete

- Xóa log cũ:
  find /var/www/vinanetwork/public_html/tools/logs/ -type f -mtime +30 -delete

- Kiểm tra API:
  - Monitor `tools_api_log.txt` để phát hiện lỗi 429 hoặc timeout.
- Cập nhật:
  - Nếu Helius API thay đổi, update `tools-api.php`.

---

6. Các Trường Hợp Lỗi và Xử Lý
| Lỗi | Mô tả | Xử lý |
| Form dưới kết quả | `.tools-form` xuất hiện sau `.tools-result` | Đảm bảo render form trước result trong PHP. |
| Rate limit không hoạt động | Submit >5 lần/phút vẫn hoạt động | Kiểm tra `$_SESSION[rate_limit_*]` trong PHP. |
| Form hiển thị khi rate limit | `.tools-form` xuất hiện cùng `.result-error` | Kiểm tra `$rate_limit_exceeded` trong PHP. |
| API error | Helius trả về lỗi | Log lỗi, hiển thị `.result-error`, retry sau 1 phút. |
| Cache không ghi được | Quyền file hoặc lock | Kiểm tra quyền `cache/*.json`, dùng `flock()`. |
| Invalid input | Address sai định dạng | Validate regex base58, hiển thị `.result-error`. |
| Export thất bại | File CSV/JSON không tải | Kiểm tra `nft-holders-export.php`, log `holders_export_log.txt`. |

---

7. Kết Luận
Trang Tools của Vina Network cung cấp 3 công cụ mạnh mẽ để phân tích blockchain Solana, với giao diện tối ưu, hiệu suất cao, và bảo mật tốt. Tài liệu này hỗ trợ team triển khai, vận hành, và bảo trì hiệu quả. Liên hệ support@vina.network để được hỗ trợ.

Ngày hoàn thành: 23/06/2025  
Team: Vina Network.

---